# Wallpaper Solution - Quick Reference

## Executive Summary

**Recommendation**: Use **wpaperd** for dynamic multi-monitor wallpaper management on River WM.

**Why**: Per-monitor wallpapers, 50+ transitions, hot config reloading, active development, NixOS-friendly.

---

## Quick Comparison Table

| Feature | swaybg (current) | swww | **wpaperd** ✅ | hyprpaper |
|---------|------------------|------|----------------|-----------|
| Per-output | ❌ | ✅ | ✅ | ✅ |
| Animations | ❌ | ✅ | ✅ | ❌ |
| Transitions | ❌ | 12+ | **50+** | ❌ |
| Runtime changes | ❌ | ✅ | ✅ | ✅ |
| River compatible | ✅ | ✅ | ✅ | ⚠️ |
| Active dev | ✅ | ❌ Archived | ✅ | ✅ |
| Complexity | ⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |

---

## Implementation Steps

### 1. Create Configuration Module
File: `modules/home/wallpaper.nix`
- Declares wpaperd package
- Systemd user service
- TOML config file with per-output settings

### 2. Update home-manager imports
File: `modules/home/default.nix`
- Add `./wallpaper.nix` to imports

### 3. Update River WM config
File: `modules/home/river.nix`
- Remove `riverctl spawn "swaybg -c '#282828'"` (line 203-204)
- Remove `swaybg` from packages list
- Add `wpaperd` to packages list

### 4. Create wallpaper directories
```bash
mkdir -p ~/Wallpapers/{ultrawide,portrait,laptop}
```

### 5. Rebuild and test
```bash
home-manager switch
wpaperctl query
```

---

## Configuration Template

**File**: `~/.config/wpaperd/config.toml` (auto-generated by Nix)

```toml
[default]
duration = "30m"
sorting = "random"
mode = "cover"
transition-time = 500

[any]
path = "/home/gabriel/Wallpapers/default.png"

["HDMI-A-1"]  # Ultrawide 21:9
path = "/home/gabriel/Wallpapers/ultrawide"
mode = "cover"
duration = "5m"

["DP-2"]  # Portrait (rotated)
path = "/home/gabriel/Wallpapers/portrait"
mode = "center"  # Keep aspect ratio
duration = "5m"

["eDP-1"]  # Laptop 2x scaled
path = "/home/gabriel/Wallpapers/laptop"
mode = "cover"
```

---

## Display Mode Reference

- `cover`: Scale to cover display (may crop). Best for ultrawide.
- `fit`: Keep aspect ratio, center with black bars. Best for portrait.
- `center`: Center image without scaling. Good for art/screenshots.
- `stretch`: Fill entire display (distorts aspect). Not recommended.
- `tile`: Repeat image to fill screen.

---

## Kanshi Integration

Kanshi automatically detects when outputs change. wpaperd adapts without restart.

**Optional**: Add notifications in kanshi exec hooks:

```nix
profile.exec = [
  "${pkgs.libnotify}/bin/notify-send 'Display Profile Changed'"
];
```

---

## Wallpaper Sources

### Ultrawide (3440x1440 / 21:9)
- Unsplash: Filter by "ultrawide" or 3440x1440
- WallpaperEngine: Ultrawide section
- Custom: Tile two 16:9 images horizontally

### Portrait (2560x1440 rotated / 9:16)
- Smartphone wallpaper collections
- Rotate 16:9 images 90°
- Search "portrait wallpaper 2560x1440"

### Laptop (3840x2400 @ 2x / 1920x1200 effective)
- Standard 16:10 or 5:4 aspect
- High-DPI quality images
- Gruvbox/color-scheme matching

---

## Runtime Control

```bash
# Check current wallpapers
wpaperctl query

# Cycle wallpapers
wpaperctl next
wpaperctl previous

# Control auto-switching
wpaperctl pause
wpaperctl resume
wpaperctl toggle-pause

# Restart daemon if needed
systemctl --user restart wpaperd
```

---

## Transition Types (Selection)

**Subtle** (for periodic changes):
- `fade` (300ms) - Smooth crossfade
- `dissolve` (1000ms) - Grainy transition
- `directional` (1000ms) - Wipe direction

**Interesting** (for manual changes):
- `circle-crop` (3000ms) - Zoom + crop
- `simple-zoom` (1500ms) - Zoom transition
- `swirl` (1500ms) - Spiral effect

---

## Troubleshooting

| Issue | Solution |
|-------|----------|
| No wallpaper appears | Check `~/.local/state/wpaperd/wallpapers/` symlinks exist |
| Daemon won't start | Ensure Mesa/OpenGL ES installed; check `journalctl --user -u wpaperd` |
| Config not reloading | Use `wpaperctl` or restart service: `systemctl --user restart wpaperd` |
| Different per monitor | Verify output names match config (use `wpaperctl query` to see actual names) |
| High CPU | Disable transitions or increase `transition-time` value |

---

## Estimated Timeline

- Create config files: 10 min
- Set up directories: 5 min
- Gather wallpapers: 20 min
- Rebuild/test: 10 min
- **Total**: ~45 minutes

---

## References

- **wpaperd GitHub**: https://github.com/danyspin97/wpaperd
- **Full Research**: See `docs/wallpaper-solution-research.md`
- **Current Kanshi Config**: `modules/home/services.nix` (lines 39-180)
- **River WM Config**: `modules/home/river.nix` (lines 203-224)

---

## Next Actions

1. ✅ Create `modules/home/wallpaper.nix`
2. ✅ Update `modules/home/default.nix`
3. ✅ Modify `modules/home/river.nix`
4. ✅ Create wallpaper directories
5. ✅ Collect wallpaper images
6. ✅ Run `home-manager switch`
7. ✅ Test with different display profiles
8. ✅ Adjust transition times and durations as preferred
